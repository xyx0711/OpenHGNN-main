# MHNF

Paper: [MHNF: Multi-hop Heterogeneous Neighborhood information Fusion graph representation learning](https://arxiv.org/pdf/2106.09289.pdf)

The author did not provide codes. So, we complete it according to the implementation of  [GTN](../GTN/README.md).

### How to run

Clone the Openhgnn-DGL

```bash
python main.py -m MHNF -t node_classification -d acm4GTN -g 0 --use_best_config
```

If you do not have gpu, set -gpu -1.

##### Candidate dataset: 

â€‹	acm4GTN/imdb4GTN

### Performance

Node classification 

| Node classification | acm4GTN | imdb4GTN |
| ------------------- | ------- | -------- |
| paper               | 93.15   | 59.52    |
| OpenHGNN            | 92.64   | 62.52    |

### TrainerFlow: node_classification

The model is  trained in semi-supervisied node classification.

#### model

- [transform_relation_graph_list](../../utils/utils.py)
  - Extract a  graph list where every graph just contains a relation.
- [HSAF](../../models/MHNF.py)
  - Contain HLHIA
  - Aggregate representation which is product in HLHIA by two-level attention mechanism. 

- [HLHIA](../../models/MHNF.py)
  - Contain HMAELayer
  - Contain the representation of every hop HMAELayer  which is generated by gcn.

- [HMAELayer](../../models/MHNF.py)
  - Contain GTConv
  - Contain the product of the adjacency matrices of two graphs getting from GTConv.
- [GTConv](../../models/MHNF.py)
  - Create a weighted graph whose adjacency matrix is the sum of the adjacency matrices of the given graph list.

### Dataset

Supported dataset: acm4GTN, imdb4GTN

Note: Every node in dataset should have the same features dimension.

#### [acm4GTN](../../dataset/#ACM)/[imdb4GTN](../../dataset/#IMDB)

We process the acm dataset given by [HAN](https://github.com/Jhy1993/HAN). It saved as dgl.heterograph and can be loaded by [dgl.load_graphs](https://docs.dgl.ai/en/latest/generated/dgl.load_graphs.html)

You can download the dataset by

```
wget https://s3.cn-north-1.amazonaws.com.cn/dgl-data/dataset/acm4GTN.zip
wget https://s3.cn-north-1.amazonaws.com.cn/dgl-data/dataset/imdb4GTN.zip
```

Or run the code mentioned above and it will download automatically.

### Hyper-parameter specific to the model

```python
num_channels = 2 # number of channel
num_layers = 3 # number of layer
adaptive_lr_flag = True # use different learning rate for weight in HMAELayer.
identity = False # don't need identity because of layers aggregation
```

Best config can be found in [best_config](../../utils/best_config.py)

### Relation to [GTN](../GTN/README.md)

MHNF model is similar to GTN. 

- The method [HMAEConv](../../models/MHNF.py) to product hybrid relationship matrix is same to [GTConv](../../models/GTN_sparse.py) .
- MHNF use layer attention to  aggregate different hop layer representation thus don't need to add identity to relation matrix set like GTN.

- MHNF use channel attention to replace channel aggregation operation in GTN and channel attention can be known as one of channel aggregation operation.

### Related API in DGL

[dgl.adj_product_graph](https://docs.dgl.ai/en/latest/generated/dgl.adj_product_graph.html#dgl-adj-product-graph) which is equivalent SpSpMM.

[dgl.adj_sum_graph](https://docs.dgl.ai/en/latest/generated/dgl.adj_sum_graph.html#dgl.adj_sum_graph)

[GraphConv](https://docs.dgl.ai/en/latest/api/python/nn.pytorch.html?#graphconv), [EdgeWeightNorm](https://docs.dgl.ai/en/latest/api/python/nn.pytorch.html?#edgeweightnorm)

## More

#### Contirbutor

Fengqi Liang[GAMMA LAB]

#### If you have any questions,

Submit an issue or email to  [lfq@bupt.edu.cn](mailto:lfq@bupt.edu.cn).

